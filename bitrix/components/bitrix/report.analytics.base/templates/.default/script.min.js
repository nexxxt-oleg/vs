(function(){BX.namespace("BX.Report.Analytics");BX.Report.Analytics.Page=function(e){this.scope=e.scope;this.menuScope=e.menuScope;this.changeBoardButtons=this.menuScope.querySelectorAll('[data-role="report-analytics-menu-item"]');this.contentContainer=this.scope.querySelector(".report-analytics-content");this.currentItem=this.menuScope.querySelector(".report-analytics-sidebar-submenu-item.report-analytics-sidebar-submenu-item-active");this.currentSelectedContainer=this.menuScope.querySelector(".report-analytics-sidebar-menu-item.report-analytics-sidebar-menu-item-active");this.pageTitle=document.getElementById("pagetitle");this.pageTitleWrap=document.querySelector(".pagetitle-wrap");this.pageControlsContainer=document.querySelector(".pagetitle-container.pagetitle-align-right-container");this.defaultBoardKey=e.defaultBoardKey;this.init()};BX.Report.Analytics.Page.prototype={init:function(){this.changeBoardButtons.forEach(function(e){BX.bind(e,"click",this.handleItemClick.bind(this))}.bind(this));this.loader=new BX.Loader({size:80});top.onpopstate=this.handlerOnPopState.bind(this)},handleContainerClick:function(e){var t=e.currentTarget;var a="report-analytics-sidebar-menu-item-active";var i=t.querySelector(".report-analytics-sidebar-submenu-item-active");if(!i&&t.classList.contains("report-analytics-sidebar-menu-item-active")){var r=t.querySelector(".report-analytics-sidebar-submenu");r.style.height=0;t.classList.remove(a)}else{this.currentSelectedContainer=t;this.currentSelectedContainer.classList.add(a);var r=this.currentSelectedContainer.querySelector(".report-analytics-sidebar-submenu");var n=r.querySelectorAll('[data-role="report-analytics-menu-item"]').length;r.style.height=36*n+n*6-6+"px"}},handleItemClick:function(e){e.preventDefault();var t=e.currentTarget;this.activateButton(e);var a=t.dataset.reportBoardKey;this.cleanPageContent();this.showLoader();BX.Report.VC.Core.ajaxPost("analytics.getBoardComponentByKey",{data:{IFRAME:"Y",boardKey:a},onFullSuccess:function(e){this.hideLoader();var i=t.dataset.disabledBoard;top.history.pushState(null,e.additionalParams.pageTitle,t.href);top.history.replaceState({reportBoardKey:a,href:t.href},e.additionalParams.pageTitle,t.href);this.changePageTitle(e.additionalParams.pageTitle);this.changePageControls(e.additionalParams.pageControlsParams);BX.html(this.contentContainer,e.data)}.bind(this)})},cleanPageContent:function(){this.pageTitle.innerText="";this.pageControlsContainer.innerText="";BX.cleanNode(this.contentContainer);if(BX.Report.Dashboard){BX.Report.Dashboard.BoardRepository.destroyBoards()}},changePageControls:function(e){var t={};t.onFullSuccess=function(e){BX.html(this.pageControlsContainer,e.html)}.bind(this);BX.Report.VC.Core._successHandler(e,t)},changePageTitle:function(e){this.pageTitle.innerText=e},showLoader:function(){this.pageTitleWrap.style.display="none";var e=BX.create("img",{attrs:{src:"/bitrix/images/report/visualconstructor/preview/view-without-menu.svg",height:"1200px",width:"100%"}});this.contentContainer.appendChild(e)},hideLoader:function(){this.pageTitleWrap.style.display="block";this.loader.hide()},activateButton:function(e){var t=e.currentTarget;if(!this.currentItem){this.currentItem=t}this.currentItem.classList.remove("report-analytics-sidebar-submenu-item-active");this.currentItem=t;this.currentItem.classList.add("report-analytics-sidebar-submenu-item-active")},handlerOnPopState:function(e){var t=this.defaultBoardKey;if(e.state.reportBoardKey!==undefined){t=e.state.reportBoardKey}this.cleanPageContent();this.showLoader();BX.Report.VC.Core.ajaxPost("analytics.getBoardComponentByKey",{data:{IFRAME:"Y",boardKey:t},onFullSuccess:function(e){this.hideLoader();this.cleanPageContent();this.changePageTitle(e.additionalParams.pageTitle);this.changePageControls(e.additionalParams.pageControlsParams);BX.html(this.contentContainer,e.data)}.bind(this)})}}})();
//# sourceMappingURL=script.map.js